// Скрипт для покращення роботи з мобільними пристроями
document.addEventListener('DOMContentLoaded', function() {
  // Перевірка чи пристрій мобільний
  const isMobile = window.innerWidth <= 768;
  
  // Функція для покращення взаємодії з таблицею на мобільних пристроях
  function enhanceTableForMobile() {
    const tableContainer = document.querySelector('.table-container');
    
    if (!tableContainer || !isMobile) return;
    
    // Додаємо індикатор горизонтального прокручування
    const scrollIndicator = document.createElement('div');
    scrollIndicator.className = 'scroll-indicator';
    scrollIndicator.innerText = '← прокрутіть →';
    scrollIndicator.style.textAlign = 'center';
    scrollIndicator.style.fontSize = '0.8em';
    scrollIndicator.style.color = 'var(--secondary-color)';
    scrollIndicator.style.opacity = '0.7';
    scrollIndicator.style.marginBottom = '10px';
    
    // Вставляємо індикатор прокручування після таблиці
    tableContainer.parentNode.insertBefore(scrollIndicator, tableContainer.nextSibling);
    
    // Зникнення індикатора після першого прокручування
    tableContainer.addEventListener('scroll', function() {
      setTimeout(() => {
        scrollIndicator.style.opacity = '0';
        scrollIndicator.style.transition = 'opacity 0.5s';
      }, 2000);
    }, { once: true });
    
    // Перевірка ширини таблиці і встановлення мінімальної ширини
    const table = tableContainer.querySelector('table');
    if (table) {
      const minWidth = Math.max(500, table.scrollWidth);
      table.style.minWidth = minWidth + 'px';
    }
  }
  
  // Функція для покращення роботи з формами на мобільних пристроях
  function enhanceFormsForMobile() {
    if (!isMobile) return;
    
    // Збільшуємо розмір полів введення для зручності на мобільних
    const numberInputs = document.querySelectorAll('input[type="number"]');
    numberInputs.forEach(input => {
      input.addEventListener('focus', function() {
        this.style.padding = '8px';
        this.style.fontSize = '16px'; // Оптимальний розмір для запобігання масштабування на iOS
      });
      
      input.addEventListener('blur', function() {
        this.style.padding = '';
        this.style.fontSize = '';
      });
    });
    
    // Оптимізація чекбоксів для сенсорних екранів
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
      // Створюємо більшу область навколо чекбокса для зручності натискання
      const wrapper = document.createElement('div');
      wrapper.style.padding = '5px';
      wrapper.style.display = 'inline-block';
      
      // Замінюємо чекбокс на обгортку
      checkbox.parentNode.insertBefore(wrapper, checkbox);
      wrapper.appendChild(checkbox);
    });
  }
  
  // Функція для оптимізації кнопок на мобільних
  function enhanceButtonsForMobile() {
    if (!isMobile) return;
    
    const buttons = document.querySelectorAll('button');
    buttons.forEach(button => {
      // Збільшуємо відступи кнопок для зручності натискання
      button.style.padding = '12px 15px';
      button.style.marginBottom = '8px';
      
      // Додаємо більше візуального зворотного зв'язку при натисканні
      button.addEventListener('touchstart', function() {
        this.style.opacity = '0.8';
      });
      
      button.addEventListener('touchend', function() {
        this.style.opacity = '1';
      });
    });
  }
  
  // Функція для оптимізації модальних вікон на мобільних
  function enhanceModalsForMobile() {
    if (!isMobile) return;
    
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
      const content = modal.querySelector('.modal-content');
      if (content) {
        // Змінюємо позиціонування для кращого відображення на мобільних
        content.style.margin = '5% auto';
        content.style.width = '95%';
        content.style.maxHeight = '90vh';
        content.style.overflow = 'auto';
      }
    });
  }
  
  // Функція для покращення роботи калькулятора на мобільних
  function enhanceCalculatorForMobile() {
    if (!isMobile) return;
    
    const calculator = document.querySelector('.calculator');
    if (!calculator) return;
    
    // Покращуємо відображення полів введення
    const inputs = calculator.querySelectorAll('input');
    inputs.forEach(input => {
      input.style.width = '100%';
      input.style.maxWidth = '200px';
      input.style.margin = '5px auto';
    });
  }
  
  // Функція для адаптивного відображення дати
  function enhanceDateDisplayForMobile() {
    if (!isMobile) return;
    
    const dateDisplay = document.getElementById('dateDisplay');
    if (!dateDisplay) return;
    
    // Скорочуємо формат дати для мобільних, якщо він занадто довгий
    const text = dateDisplay.innerText;
    if (text.length > 20) {
      // Спробуємо скоротити назви місяців або формат дати
      dateDisplay.style.fontSize = '0.9em';
    }
  }
  
  // Викликаємо всі функції оптимізації для мобільних
  function initMobileOptimizations() {
    enhanceTableForMobile();
    enhanceFormsForMobile();
    enhanceButtonsForMobile();
    enhanceModalsForMobile();
    enhanceCalculatorForMobile();
    enhanceDateDisplayForMobile();
    
    // Додаємо обробники для орієнтації екрану
    window.addEventListener('orientationchange', function() {
      // Короткий таймаут для того, щоб перебудувати верстку після зміни орієнтації
      setTimeout(() => {
        enhanceTableForMobile();
        enhanceModalsForMobile();
      }, 300);
    });
  }
  
  // Запускаємо оптимізацію на мобільних пристроях
  if (isMobile) {
    initMobileOptimizations();
    
    // Додаємо мета-тег для коректного масштабування на мобільних
    const meta = document.createElement('meta');
    meta.name = 'viewport';
    meta.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';
    document.head.appendChild(meta);
  }
});
