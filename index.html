<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–¢–∞–±–ª–∏—Ü—è –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–æ—Å—Ç—ñ –∫–ª—É–±—É "–Ø–©–Ü–†–ö–ê"</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid black;
      padding: 4px;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
    }
    input {
      width: 100%;
      box-sizing: border-box;
      text-align: center;
    }
    button {
      margin: 10px 5px;
      padding: 5px 10px;
    }
  </style>
</head>
<body>
  <!-- –ì–æ–¥–∏–Ω–Ω–∏–∫ -->
  <div>üïí –ü–æ—Ç–æ—á–Ω–∏–π —á–∞—Å: <span id="clock"></span></div>

  <!-- –í–∏–±—ñ—Ä –º—ñ—Å—è—Ü—è -->
  <label for="monthSelect">üìÖ –í–∏–±–µ—Ä—ñ—Ç—å –º—ñ—Å—è—Ü—å:</label>
  <select id="monthSelect" onchange="updateMonthDays()">
    <option value="31" data-days="31">–°—ñ—á–µ–Ω—å</option>
    <option value="28" data-days="28">–õ—é—Ç–∏–π</option>
    <option value="31" data-days="31">–ë–µ—Ä–µ–∑–µ–Ω—å</option>
    <option value="30" data-days="30">–ö–≤—ñ—Ç–µ–Ω—å</option>
    <option value="31" data-days="31">–¢—Ä–∞–≤–µ–Ω—å</option>
    <option value="30" data-days="30">–ß–µ—Ä–≤–µ–Ω—å</option>
    <option value="31" data-days="31">–õ–∏–ø–µ–Ω—å</option>
    <option value="31" data-days="31">–°–µ—Ä–ø–µ–Ω—å</option>
    <option value="30" data-days="30">–í–µ—Ä–µ—Å–µ–Ω—å</option>
    <option value="31" data-days="31">–ñ–æ–≤—Ç–µ–Ω—å</option>
    <option value="30" data-days="30">–õ–∏—Å—Ç–æ–ø–∞–¥</option>
    <option value="31" data-days="31">–ì—Ä—É–¥–µ–Ω—å</option>
  </select>

  <br><br>

  <!-- –¢–∞–±–ª–∏—Ü—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
  <table>
    <thead>
      <tr>
        <th>–î–Ω—ñ–≤ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–æ</th>
        <th>–í–∞—Ä—Ç—ñ—Å—Ç—å –∑–∞ –¥–µ–Ω—å (500 –≥—Ä–Ω)</th>
        <th>–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="text" /></td>
        <td><input type="number" id="daysAttended" oninput="updateTotal()" /></td>
        <td><input type="number" value="500" readonly /></td>
        <td><input type="number" id="totalPayment" readonly /></td>
      </tr>
    </tbody>
  </table>

  <br>
  <h2>–í—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è –∫–ª—É–±—É "–Ø–©–Ü–†–ö–ê"</h2>

  <button onclick="saveTableData()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ</button>
  <button onclick="clearTableData()">–û—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ</button>
  <button onclick="addRow()">‚ûï –î–æ–¥–∞—Ç–∏ —Ä—è–¥–æ–∫</button>
  <button onclick="exportToPDF()">üìÑ –ï–∫—Å–ø–æ—Ä—Ç –≤ PDF</button>

  <table id="attendanceTable">
    <thead>
      <tr>
        <th>–Ü–º'—è –¥–∏—Ç–∏–Ω–∏</th>
        <th>01</th><th>02</th><th>03</th><th>04</th><th>05</th>
        <th>06</th><th>07</th><th>08</th><th>09</th><th>10</th>
        <th>11</th><th>12</th><th>13</th><th>14</th><th>15</th>
        <th>16</th><th>17</th><th>18</th><th>19</th><th>20</th>
        <th>21</th><th>22</th><th>23</th><th>24</th><th>25</th>
        <th>26</th><th>27</th><th>28</th><th>29</th><th>30</th>
        <th>31</th>
        <th>–í—Å—å–æ–≥–æ</th>
        <th>–û–ø–ª–∞—Ç–∞</th>
        <th>–ó–∞–ª–∏—à–æ–∫</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="text" /></td>
        <!-- 31 —á–µ–∫–±–æ–∫—Å -->
        <td><input type="checkbox" /></td><td><input type="checkbox" /></td><td><input type="checkbox" /></td>
        <td><input type="checkbox" /></td><td><input type="checkbox" /></td><td><input type="checkbox" /></td>
        <td><input type="checkbox" /></td><td><input type="checkbox" /></td><td><input type="checkbox" /></td>
        <td><input type="checkbox" /></td><td><input type="checkbox" /></td><td><input type="checkbox" /></td>
        <td><input type="checkbox" /></td><td><input type="checkbox" /></td><td><input type="checkbox" /></td>
        <td><input type="checkbox" /></td><td><input type="checkbox" /></td><td><input type="checkbox" /></td>
        <td><input type="checkbox" /></td><td><input type="checkbox" /></td><td><input type="checkbox" /></td>
        <td><input type="checkbox" /></td><td><input type="checkbox" /></td><td><input type="checkbox" /></td>
        <td><input type="checkbox" /></td><td><input type="checkbox" /></td><td><input type="checkbox" /></td>
        <td><input type="checkbox" /></td><td><input type="checkbox" /></td><td><input type="checkbox" /></td>
        <td><input type="checkbox" /></td>
        <td><input type="number" readonly /></td>
        <td><input type="number" /></td>
        <td><input type="number" readonly /></td>
      </tr>
    </tbody>
  </table>

  <script>
    const table = document.getElementById('attendanceTable');
const MAX_ROWS = 20;

// –í–∏–∑–Ω–∞—á–∞—î–º–æ –≤–∏—Ö—ñ–¥–Ω—ñ (—Å—É–±–æ—Ç–∞ —Ç–∞ –Ω–µ–¥—ñ–ª—è)
function isWeekend(day) {
  return day % 7 === 6 || day % 7 === 0; // –í—Ä–∞—Ö–æ–≤—É—î–º–æ, —â–æ 1 - —Ü–µ –ø–æ–Ω–µ–¥—ñ–ª–æ–∫
}

// –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥—Å—É–º–∫—ñ–≤ –ø–æ –∫–æ–∂–Ω–æ–º—É —Ä—è–¥–∫—É
function updateRowTotals(row) {
  const inputs = row.querySelectorAll('input');
  let attendance = 0;
  let totalPayment = 0;
  let paidAmount = parseFloat(inputs[inputs.length - 3].value) || 0; // –û–ø–ª–∞—á–µ–Ω–∞ —Å—É–º–∞

  // –ü–µ—Ä–µ–±–∏—Ä–∞—î–º–æ –≤—Å—ñ –¥–Ω—ñ (–≤—ñ–¥ 1 –¥–æ 31) —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —Ü–µ –±—É–¥–Ω—ñ–π –¥–µ–Ω—å
  for (let i = 1; i < inputs.length - 4; i++) { 
    if (inputs[i].type === 'checkbox' && inputs[i].checked) {
      // –Ø–∫—â–æ —Ü–µ –±—É–¥–Ω—ñ–π –¥–µ–Ω—å, –≤—Ä–∞—Ö–æ–≤—É—î–º–æ –æ–ø–ª–∞—Ç—É
      if (!isWeekend(i)) {
        attendance++; // –õ—ñ—á–∏–º–æ —Ç—ñ–ª—å–∫–∏ –±—É–¥–Ω—ñ –¥–Ω—ñ
        totalPayment += 500; // –í–∞—Ä—Ç—ñ—Å—Ç—å –∑–∞ –¥–µ–Ω—å –¥–ª—è –±—É–¥–Ω—ñ—Ö –¥–Ω—ñ–≤
      }
    }
  }

  const totalField = inputs[inputs.length - 4]; // –ö–æ–ª–æ–Ω–∫–∞ "–í—Å—å–æ–≥–æ"
  const dailyPaymentField = inputs[inputs.length - 3]; // –ö–æ–ª–æ–Ω–∫–∞ "–û–ø–ª–∞—Ç–∞ –∑–∞ –¥–µ–Ω—å"
  const fullMonthPaymentField = inputs[inputs.length - 2]; // –ö–æ–ª–æ–Ω–∫–∞ "–ü–æ–≤–Ω–∞ –æ–ø–ª–∞—Ç–∞"
  const balanceField = inputs[inputs.length - 1]; // –ö–æ–ª–æ–Ω–∫–∞ "–ó–∞–ª–∏—à–æ–∫"

  // –û–Ω–æ–≤–ª—é—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è
  totalField.value = attendance; // –í—Å—å–æ–≥–æ –≤—ñ–¥–≤—ñ–¥–∞–Ω–æ –±—É–¥–Ω—ñ—Ö –¥–Ω—ñ–≤
  dailyPaymentField.value = totalPayment; // –û–ø–ª–∞—Ç–∞ –∑–∞ –±—É–¥–Ω—ñ –¥–Ω—ñ
  fullMonthPaymentField.value = (31 - 8) * 500; // –ü–æ–≤–Ω–∞ –º—ñ—Å—è—á–Ω–∞ –æ–ø–ª–∞—Ç–∞ –±–µ–∑ –≤–∏—Ö—ñ–¥–Ω–∏—Ö (31 –¥–µ–Ω—å –º—ñ–Ω—É—Å 8 –≤–∏—Ö—ñ–¥–Ω–∏—Ö)
  balanceField.value = paidAmount - totalPayment; // –ë–∞–ª–∞–Ω—Å = –æ–ø–ª–∞—á–µ–Ω–æ - —Å—É–º—É –∑–∞ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—ñ
function saveTableData() {
  const data = [];
  const rows = table.querySelectorAll('tbody tr');

  rows.forEach(row => {
    const inputs = row.querySelectorAll('input');
    const rowData = [];
    inputs.forEach(input => {
      if (input.type === 'checkbox') {
        rowData.push(input.checked);
      } else {
        rowData.push(input.value);
      }
    });
    data.push(rowData);
  });

  localStorage.setItem('tableData', JSON.stringify(data));
  localStorage.setItem('rowCount', rows.length); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä—è–¥–∫—ñ–≤
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—ñ
function loadTableData() {
  const data = JSON.parse(localStorage.getItem('tableData')) || [];
  const rowCount = parseInt(localStorage.getItem('rowCount')) || MAX_ROWS;

  // –î–æ–¥–∞—î–º–æ –ø–æ—Ç—Ä—ñ–±–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä—è–¥–∫—ñ–≤
  const currentRows = table.querySelectorAll('tbody tr').length;
  for (let i = currentRows; i < rowCount; i++) {
    addRow();
  }

  const rows = table.querySelectorAll('tbody tr');
  rows.forEach((row, rowIndex) => {
    const inputs = row.querySelectorAll('input');
    const rowData = data[rowIndex];
    if (!rowData) return;

    inputs.forEach((input, i) => {
      if (input.type === 'checkbox') {
        input.checked = rowData[i];
      } else {
        input.value = rowData[i];
      }
    });
  });

  updateAllTotals();
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—ñ
function clearTableData() {
  localStorage.removeItem('tableData');
  localStorage.removeItem('rowCount');
  location.reload();
}

// –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö –ø—ñ–¥—Å—É–º–∫—ñ–≤ —Ç–∞–±–ª–∏—Ü—ñ
function updateAllTotals() {
  const rows = table.querySelectorAll('tbody tr');
  rows.forEach(row => updateRowTotals(row));
}

// –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ä—è–¥–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü—é
function addRow() {
  const tbody = table.querySelector('tbody');
  const firstRow = tbody.querySelector('tr');
  const newRow = firstRow.cloneNode(true);

  const inputs = newRow.querySelectorAll('input');
  inputs.forEach((input, index) => {
    if (input.type === 'checkbox') {
      input.checked = false;
    } else {
      input.value = '';
    }

    if (index === inputs.length - 2 || index === inputs.length - 1) {
      input.readOnly = true;
    }
  });

  tbody.appendChild(newRow);
}

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
window.onload = () => {
  loadTableData();
};

// –û–±—Ä–æ–±–∫–∞ –≤–≤–æ–¥—É –≤ —Ç–∞–±–ª–∏—Ü—ñ –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥—Å—É–º–∫—ñ–≤
table.addEventListener('input', (e) => {
  const row = e.target.closest('tr');
  if (row) updateRowTotals(row);
  saveTableData();
});

// –û–±—Ä–æ–±–∫–∞ –∑–º—ñ–Ω–∏ (checkbox) –≤ —Ç–∞–±–ª–∏—Ü—ñ –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥—Å—É–º–∫—ñ–≤
table.addEventListener('change', (e) => {
  const row = e.target.closest('tr');
  if (row) updateRowTotals(row);
  saveTableData();
});

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É –≤ PDF
function exportToPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.text("–í—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è –∫–ª—É–±—É '–Ø–©–Ü–†–ö–ê'", 10, 10);

  let table = document.getElementById("attendanceTable");
  let rows = table.querySelectorAll("tr");
  let y = 20;

  rows.forEach(row => {
    let cells = row.querySelectorAll("th, td");
    let text = [];

    cells.forEach(cell => {
      let input = cell.querySelector("input");
      if (input) {
        if (input.type === "checkbox") {
          text.push(input.checked ? "‚úì" : " ");
        } else {
          text.push(input.value);
        }
      } else {
        text.push(cell.innerText);
      }
    });

    doc.text(text.join(" | "), 10, y);
    y += 10;
  });

  doc.save("attendance.pdf");
}

</script>
 </body> 
 </html>
